import { Component, OnInit, Query } from '@angular/core';
import { environment } from '../../environments/environment';
import * as mapboxgl from 'mapbox-gl';
import * as MapboxGeocoder from '@mapbox/mapbox-gl-geocoder';


@Component({
  selector: 'app-ui-map',
  templateUrl: './ui-map.component.html',
  styleUrls: ['./ui-map.component.css']
})

export class UiMapComponent implements OnInit {

    static getMarkers: any;


  constructor() { }


ngOnInit() {


  (mapboxgl as any).accessToken = environment.mapbox.accessToken;

  const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v11',
    center: [-98.491142, 29.424349],
    zoom: 7
  });

  const mapresultLat = map.getCenter().lat;
  const mapresultLong = map.getCenter().lng;
  console.log(mapresultLat);
  console.log(mapresultLong);


  let geocoder = new MapboxGeocoder({
accessToken: mapboxgl.accessToken,
localGeocoder: this.coordinatesGeocoder,
zoom: 6,
marker: true,
mapboxgl
});

  map.addControl(geocoder, 'top-left');

  map.addControl(new mapboxgl.NavigationControl());

  map.on('result', function(e) {
    console.log(e.lngLat);
  });

  map.on('click', function(e) {
  console.log('A click event has occurred at ' + e.lngLat[1]);
});


}

coordinatesGeocoder = function(query: { match: (arg0: RegExp) => boolean; }) {
const matches = query.match(
/^[ ]*(?:Lat: )?(-?\d+\.?\d*)[, ]+(?:Lng: )?(-?\d+\.?\d*)[ ]*$/i
);
if (!matches) {
return null;
}


function coordinateFeature(lng: string | number, lat: string | number) {
return {
center: [lng, lat],
geometry: {
type: 'Point',
coordinates: [lng, lat]
},
place_name: 'Lat: ' + lat + ' Lng: ' + lng,
place_type: ['coordinate'],
properties: {},
type: 'Feature'
};
}


const coord1 = Number(matches[1]);
console.log(coord1);
const coord2 = Number(matches[2]);
console.log(coord2);
const geocodes = [];


if (coord1 < -90 || coord1 > 90) {
// must be lng, lat
geocodes.push(coordinateFeature(coord1, coord2));
}

if (coord2 < -90 || coord2 > 90) {
// must be lat, lng
geocodes.push(coordinateFeature(coord2, coord1));
}

if (geocodes.length === 0) {
// else could be either lng, lat or lat, lng
geocodes.push(coordinateFeature(coord1, coord2));
geocodes.push(coordinateFeature(coord2, coord1));
}
console.log(geocodes);
return geocodes;
};


}
